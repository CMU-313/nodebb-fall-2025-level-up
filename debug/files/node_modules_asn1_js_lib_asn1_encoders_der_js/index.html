<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - node_modules/asn1.js/lib/asn1/encoders/der.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>node_modules/asn1.js/lib/asn1/encoders/der.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">56.83</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">295</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">65.28</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.33</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

const inherits = require(&#039;inherits&#039;);
const Buffer = require(&#039;safer-buffer&#039;).Buffer;
const Node = require(&#039;../base/node&#039;);

// Import DER constants
const der = require(&#039;../constants/der&#039;);

function DEREncoder(entity) {
  this.enc = &#039;der&#039;;
  this.name = entity.name;
  this.entity = entity;

  // Construct base tree
  this.tree = new DERNode();
  this.tree._init(entity.body);
}
module.exports = DEREncoder;

DEREncoder.prototype.encode = function encode(data, reporter) {
  return this.tree._encode(data, reporter).join();
};

// Tree methods

function DERNode(parent) {
  Node.call(this, &#039;der&#039;, parent);
}
inherits(DERNode, Node);

DERNode.prototype._encodeComposite = function encodeComposite(tag,
  primitive,
  cls,
  content) {
  const encodedTag = encodeTag(tag, primitive, cls, this.reporter);

  // Short form
  if (content.length &lt; 0x80) {
    const header = Buffer.alloc(2);
    header[0] = encodedTag;
    header[1] = content.length;
    return this._createEncoderBuffer([ header, content ]);
  }

  // Long form
  // Count octets required to store length
  let lenOctets = 1;
  for (let i = content.length; i &gt;= 0x100; i &gt;&gt;= 8)
    lenOctets++;

  const header = Buffer.alloc(1 + 1 + lenOctets);
  header[0] = encodedTag;
  header[1] = 0x80 | lenOctets;

  for (let i = 1 + lenOctets, j = content.length; j &gt; 0; i--, j &gt;&gt;= 8)
    header[i] = j &amp; 0xff;

  return this._createEncoderBuffer([ header, content ]);
};

DERNode.prototype._encodeStr = function encodeStr(str, tag) {
  if (tag === &#039;bitstr&#039;) {
    return this._createEncoderBuffer([ str.unused | 0, str.data ]);
  } else if (tag === &#039;bmpstr&#039;) {
    const buf = Buffer.alloc(str.length * 2);
    for (let i = 0; i &lt; str.length; i++) {
      buf.writeUInt16BE(str.charCodeAt(i), i * 2);
    }
    return this._createEncoderBuffer(buf);
  } else if (tag === &#039;numstr&#039;) {
    if (!this._isNumstr(str)) {
      return this.reporter.error(&#039;Encoding of string type: numstr supports &#039; +
                                 &#039;only digits and space&#039;);
    }
    return this._createEncoderBuffer(str);
  } else if (tag === &#039;printstr&#039;) {
    if (!this._isPrintstr(str)) {
      return this.reporter.error(&#039;Encoding of string type: printstr supports &#039; +
                                 &#039;only latin upper and lower case letters, &#039; +
                                 &#039;digits, space, apostrophe, left and rigth &#039; +
                                 &#039;parenthesis, plus sign, comma, hyphen, &#039; +
                                 &#039;dot, slash, colon, equal sign, &#039; +
                                 &#039;question mark&#039;);
    }
    return this._createEncoderBuffer(str);
  } else if (/str$/.test(tag)) {
    return this._createEncoderBuffer(str);
  } else if (tag === &#039;objDesc&#039;) {
    return this._createEncoderBuffer(str);
  } else {
    return this.reporter.error(&#039;Encoding of string type: &#039; + tag +
                               &#039; unsupported&#039;);
  }
};

DERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {
  if (typeof id === &#039;string&#039;) {
    if (!values)
      return this.reporter.error(&#039;string objid given, but no values map found&#039;);
    if (!values.hasOwnProperty(id))
      return this.reporter.error(&#039;objid not found in values map&#039;);
    id = values[id].split(/[\s.]+/g);
    for (let i = 0; i &lt; id.length; i++)
      id[i] |= 0;
  } else if (Array.isArray(id)) {
    id = id.slice();
    for (let i = 0; i &lt; id.length; i++)
      id[i] |= 0;
  }

  if (!Array.isArray(id)) {
    return this.reporter.error(&#039;objid() should be either array or string, &#039; +
                               &#039;got: &#039; + JSON.stringify(id));
  }

  if (!relative) {
    if (id[1] &gt;= 40)
      return this.reporter.error(&#039;Second objid identifier OOB&#039;);
    id.splice(0, 2, id[0] * 40 + id[1]);
  }

  // Count number of octets
  let size = 0;
  for (let i = 0; i &lt; id.length; i++) {
    let ident = id[i];
    for (size++; ident &gt;= 0x80; ident &gt;&gt;= 7)
      size++;
  }

  const objid = Buffer.alloc(size);
  let offset = objid.length - 1;
  for (let i = id.length - 1; i &gt;= 0; i--) {
    let ident = id[i];
    objid[offset--] = ident &amp; 0x7f;
    while ((ident &gt;&gt;= 7) &gt; 0)
      objid[offset--] = 0x80 | (ident &amp; 0x7f);
  }

  return this._createEncoderBuffer(objid);
};

function two(num) {
  if (num &lt; 10)
    return &#039;0&#039; + num;
  else
    return num;
}

DERNode.prototype._encodeTime = function encodeTime(time, tag) {
  let str;
  const date = new Date(time);

  if (tag === &#039;gentime&#039;) {
    str = [
      two(date.getUTCFullYear()),
      two(date.getUTCMonth() + 1),
      two(date.getUTCDate()),
      two(date.getUTCHours()),
      two(date.getUTCMinutes()),
      two(date.getUTCSeconds()),
      &#039;Z&#039;
    ].join(&#039;&#039;);
  } else if (tag === &#039;utctime&#039;) {
    str = [
      two(date.getUTCFullYear() % 100),
      two(date.getUTCMonth() + 1),
      two(date.getUTCDate()),
      two(date.getUTCHours()),
      two(date.getUTCMinutes()),
      two(date.getUTCSeconds()),
      &#039;Z&#039;
    ].join(&#039;&#039;);
  } else {
    this.reporter.error(&#039;Encoding &#039; + tag + &#039; time is not supported yet&#039;);
  }

  return this._encodeStr(str, &#039;octstr&#039;);
};

DERNode.prototype._encodeNull = function encodeNull() {
  return this._createEncoderBuffer(&#039;&#039;);
};

DERNode.prototype._encodeInt = function encodeInt(num, values) {
  if (typeof num === &#039;string&#039;) {
    if (!values)
      return this.reporter.error(&#039;String int or enum given, but no values map&#039;);
    if (!values.hasOwnProperty(num)) {
      return this.reporter.error(&#039;Values map doesn\&#039;t contain: &#039; +
                                 JSON.stringify(num));
    }
    num = values[num];
  }

  // Bignum, assume big endian
  if (typeof num !== &#039;number&#039; &amp;&amp; !Buffer.isBuffer(num)) {
    const numArray = num.toArray();
    if (!num.sign &amp;&amp; numArray[0] &amp; 0x80) {
      numArray.unshift(0);
    }
    num = Buffer.from(numArray);
  }

  if (Buffer.isBuffer(num)) {
    let size = num.length;
    if (num.length === 0)
      size++;

    const out = Buffer.alloc(size);
    num.copy(out);
    if (num.length === 0)
      out[0] = 0;
    return this._createEncoderBuffer(out);
  }

  if (num &lt; 0x80)
    return this._createEncoderBuffer(num);

  if (num &lt; 0x100)
    return this._createEncoderBuffer([0, num]);

  let size = 1;
  for (let i = num; i &gt;= 0x100; i &gt;&gt;= 8)
    size++;

  const out = new Array(size);
  for (let i = out.length - 1; i &gt;= 0; i--) {
    out[i] = num &amp; 0xff;
    num &gt;&gt;= 8;
  }
  if(out[0] &amp; 0x80) {
    out.unshift(0);
  }

  return this._createEncoderBuffer(Buffer.from(out));
};

DERNode.prototype._encodeBool = function encodeBool(value) {
  return this._createEncoderBuffer(value ? 0xff : 0);
};

DERNode.prototype._use = function use(entity, obj) {
  if (typeof entity === &#039;function&#039;)
    entity = entity(obj);
  return entity._getEncoder(&#039;der&#039;).tree;
};

DERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {
  const state = this._baseState;
  let i;
  if (state[&#039;default&#039;] === null)
    return false;

  const data = dataBuffer.join();
  if (state.defaultBuffer === undefined)
    state.defaultBuffer = this._encodeValue(state[&#039;default&#039;], reporter, parent).join();

  if (data.length !== state.defaultBuffer.length)
    return false;

  for (i=0; i &lt; data.length; i++)
    if (data[i] !== state.defaultBuffer[i])
      return false;

  return true;
};

// Utility methods

function encodeTag(tag, primitive, cls, reporter) {
  let res;

  if (tag === &#039;seqof&#039;)
    tag = &#039;seq&#039;;
  else if (tag === &#039;setof&#039;)
    tag = &#039;set&#039;;

  if (der.tagByName.hasOwnProperty(tag))
    res = der.tagByName[tag];
  else if (typeof tag === &#039;number&#039; &amp;&amp; (tag | 0) === tag)
    res = tag;
  else
    return reporter.error(&#039;Unknown tag: &#039; + tag);

  if (res &gt;= 0x1f)
    return reporter.error(&#039;Multi-octet tag encoding unsupported&#039;);

  if (!primitive)
    res |= 0x20;

  res |= (der.tagClassByName[cls || &#039;universal&#039;] &lt;&lt; 6);

  return res;
}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
